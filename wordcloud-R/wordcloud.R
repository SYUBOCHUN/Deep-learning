#0322 ??????????????????????????????????????????????????????????????????no.0322
#0323 ???????????????????????????????????????????????????????????????


library("tm") #????????????
library("SnowballC") #????????????
library("wordcloud2") # ???????????????
library("RColorBrewer") # ???????????????
library("webshot") # HTML to png,jpg,pdf!!
library("htmlwidgets") # HTML to png,jpg,pdf!!


{
  #????????????data??????????????????
  setwd("/Users/mac/Desktop/wordcloud/2018/03/20")
  getwd()
  list.files()
  
  
  #????????????????????????????????????????????????txt???
  repeat{
    INFILES <- list.files(pattern = ".txt") #?????????INFILES???????????????While??????ERROR
    OUTFILES <- vector(mode = "character", length = length(INFILES))  
    
    while(length(INFILES) == 0){
      INFILES <- list.files(pattern = ".txt")
      Sys.sleep(6)
      print("no. txt file")
    } 
    Sys.sleep(3)
    print("yes. txt file")
    break
  }
  
  #????????????
  filename <- INFILES[]
  #????????????
  filesize <- file.info(INFILES)[,1]
  #??????????????????
  data <- data.frame(filename, filesize)
  View(data)
  
  #?????????????????????
  #number <- length(filename)
  
  #????????????????????????length(INFILES)
  #??????????????????"50"???????????????
  for(i in 1:length(INFILES)){
    if(filesize[i] > 0){
      OUTFILES[i] = read.csv(file = INFILES[i], header = TRUE, fill = TRUE,skipNul = T,sep ="|")
      
      write.csv(OUTFILES[i], file = paste0(sub(".txt","" ,INFILES[i]), ".csv"))
    }
  }
  
  #sapply???????????????????????????????????????????????????????????????!!?????????CSV!!
  incsv=list.files(pattern = ".csv")
  Sys.sleep(1)
  
  as <-sapply(incsv,read.csv)
  Sys.sleep(1)
  #####################################################################
  
  # ????????????"?????????"???????????????
  docs <- VCorpus(VectorSource(as))
  
  # ????????????
  inspect(docs)
  
  # ?????????????????????"??????"??????
  toSpace <- content_transformer(function (x , pattern ) gsub(pattern, " ", x))
  docs <- tm_map(docs, toSpace, "/") # ???"/"???"??????"??????
  docs <- tm_map(docs, toSpace, "@") # ???"@"???"??????"??????
  docs <- tm_map(docs, toSpace, "\\|") # ???"\\|"???"??????"??????
  docs <- tm_map(docs, toSpace, "???") # ???"|"???"??????"??????
  Sys.sleep(1)
  
  
  docs <- tm_map(docs, removeNumbers) # ????????????
  Sys.sleep(1)
  # ??????????????????"????????????"
  docs <- tm_map(docs, removeWords,stopwords("english"))
  docs <- tm_map(docs, removeWords,c("cst","geoprecis","jan","tue","https","tco","time","timezon","feb"))
  docs <- tm_map(docs, removePunctuation) # ??????????????????
  
  docs <- tm_map(docs, stripWhitespace) # ???????????????"??????"
  Sys.sleep(1)
  
  dtm <- TermDocumentMatrix(docs)
  m <- as.matrix(dtm)
  v <- sort(rowSums(m),decreasing = TRUE)
  d <- data.frame(word = names(v),freq = v)
  Sys.sleep(1)
  
  # ??????????????????50??????????????????????????????
  h <- head(d, 50)
  Sys.sleep(1)
  
  # ??????????????????????????????
  set.seed(1000)
  
  # ???????????????
  figPath = system.file("examples/t.png", package = "wordcloud2")
  y <- wordcloud2(h,size = 1, shape  = figPath)
  #?????????????????????????????????html???????????????webshot??????PNG?????????????????????
  sizingPolicy(defaultWidth = 100)
  saveWidget(y,"y.html",selfcontained = F)
  webshot("y.html", "/Users/mac/Desktop/pic/0320.png" ,delay = 2)
}
word <- h[1]
freq <- h[2] 
z <- data.frame(word, freq)
View(z)

